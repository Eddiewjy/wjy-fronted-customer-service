# 项目设计文档

  

## 1. 系统架构

  

### 整体架构

该项目是一个仿2233.ai的前端客服系统，基于 React、TypeScript、Vite 和 ShadCN 构建，主要利用了 ShadCN 提供的便捷组件。所有的前端代码通过 Vite 进行构建，并且与讯飞星火 API 实现交互，提供 AI 客服回答。除了最后一个用apifox设计接口文档的加分项未完成外其他都已实现。

颜色灵感来自于杭助的官方配色#3085f3（在官网用edge开发者工具获取）；UI设计逻辑基本沿袭2233.ai的样式，每个可交互的地方均有`cursor-pointer` 和 `hover:bg-blue-200`悬浮效果，用户不会错过。

  
### 技术栈

- **前端：** React (React 18 + TypeScript) + Vite + ShadCN

- **API：** 讯飞星火API（用于简单提供AI回复功能，未微调训练）

- **样式框架：** Tailwind CSS + ShadCN

- **图标：** React Icons（例如：FaHeadset 用于客服按钮）

- **动画：** GSAP（用于界面动画效果）

  

### 组件化结构（`src/components`）

- **`CustomerServiceButton`**：固定在页面右下角的圆形按钮，具有鼠标悬停动画，点击后打开客服窗口。

- **`AnswerWindow`**：显示问题列表、群聊外链、AI解答窗口等功能。

- **`QuestionList`**：展示常见问题，点击后展示详细答案，使用卡片组件样式。

- **`AIChat`**：与讯飞星火AI进行交互，通过 WebSocket 实时获取 AI 回答，并展示在界面上。

- **`QQLink`**：提供跳转到QQ群外链的功能，帮助用户解决无法通过AI解答的问题。

  
### API交互

- 用户输入问题后，前端通过 WebSocket 连接讯飞星火的 API。目前暂不支持上下文。

- 讯飞星火 AI 返回的回答通过 `Card` 组件在答疑窗口中展示。

  

## 2. 五大项目核心组件代码及原理解释

  
### 2.1客服按钮 `CustomerServiceButton`

**功能说明**:

`CustomerServiceButton` 组件是整个客服系统的入口按钮，固定显示在页面的右下角。当用户点击此按钮时，会弹出 `AnswerWindow` 窗口，展示常见问题和 AI 客服功能。按钮在鼠标悬浮时会有放大的效果，增强交互感。

  

**主要代码原理**：

- 定位与样式：使用 CSS 的 `position: fixed` 使按钮固定在页面右下角，通过 `transform: scale()` 实现鼠标悬浮时的放大效果。


- 与 `AnswerWindow` 交互：`CustomerServiceButton` 通过接收 `onClick` 属性来控制 `AnswerWindow` 的显示与隐藏。点击客服按钮触发 `onClick` 事件，进而调用父组件中的 `toggleAnswerWindow` 函数。 `toggleAnswerWindow` 函数改变 `isAnswerWindowVisible` 的状态，进而通过条件渲染控制 `AnswerWindow` 组件的显示与消失。
  
  
  

### 2.2答疑窗口`AnswerWindow`

**功能说明**:

`AnswerWindow` 是客服系统的主要交互窗口，展示常见问题、AI 客服回答以及群聊外链等。用户可以在此窗口与 AI 进行对话，并查看相关问题的详细答案。

**主要代码原理**：

-  通过 `useEffect` 的作用是控制组件在渲染时响应 `isOpen` 状态的变化，并且根据状态的变化触发 GSAP 动画，实现答疑窗口平滑的消失与显示；集成了 `QuestionList` `AIchat` `QQLink`三个组件，均用`Card`进行二次包裹，实现了分区，是答疑的主体界面。侧边加入了`ScrollArea`滚动条，让界面能容纳更多内容。

- 背景采用线性模糊进行过渡，更加美观，灵感来自2233ai。所有组件均使用圆角，更加柔和。


### 2.3问题列表`QuestionList`

**功能说明**:

 展示常见问题，点击问题后展示详细解答，并且带有动画效果。（必须承认这里偷懒了，没有设计一个跳转到新页面的完整解答，单纯利用了改变高度和控制显示和隐藏投机取巧了一下。）

**主要代码原理**：

- 状态管理 (`useState`)控制答案的显示和隐藏，如果选中就展开详细解答。
- 采用了`gsap` 动画实现更平滑的答案展开效果。


### 2.4AI客服`AIChat`

**功能说明：**

`AIChat` 组件负责处理与讯飞星火 API 的交互，用户输入问题后，组件会发送请求并展示 AI 的回答。

**主要代码原理：**
 - 生成鉴权URL：根据讯飞的doc和经验帖生成鉴权URL，会在首次渲染后运行一次，用于建立WebSocket链接。
 - WebSocket 连接：通过 `useEffect` 建立 WebSocket 连接，与讯飞星火 API 进行通信。
- 消息发送：构建一个包含用户消息的 payload，其中包含系统消息（用于告诉 AI 它的角色）和用户输入的消息。用户输入问题后，发送消息给 AI，AI 会回复并更新聊天记录。
- UI 组件：通过 `Dialog` 和`Input`控制聊天界面的显示与隐藏，使用 `messages` 状态来动态渲染聊天记录。

  

### 2.5群聊外链`QQLink`

- 在 `AnswerWindow` 内提供一个QQ群外链，点击后跳转到对应QQ群页面，可以快乐加群玩耍。格式与上面的保持一致。
- `rel="noopener noreferrer"` 防止钓鱼攻击





## 3.设计过程日志
11/27晚：任务布置。由于完全没接触过前端就找gpt问了一堆问题。根据其指引搭建好了开发环境，并且形成成了最初版本（无敌粗糙，没有任何可交互提示，页面丑的爆炸，点这里查看），由于是gpt自动生成，没有利用任何shadcn组件，完全按照tsx原始代码来。而且一开始那个版本点击答疑按钮以后什么效果都看不见，后来发现是gsap效果出错，使得组件没有完全显示出来。解决完这个以后就去休息了。

11/28~29：开始修修补补。接入shadcn组件，美化了大部分界面，加入了QQ外链，加入按钮的悬浮效果，统一格式等。一开始打算用Button组件设计回答列表，发现很难以优雅的方式展开答案，于是改用了Card，之后的组件也按照统一格式设计。之前在群里文的那个问题（关于模板封装）我实际上并没有解决，发现如果要按照固定格式外观设计组件，那么模板代码似乎会比较复杂（也有可能是GPT胡言乱语），而我想的是相对简单的方式，总之这里是个略带遗憾的地方。但是后来发现就算没有模板也没有那么麻烦，只要ctrlcv一下类名就解决了，也不算冗长（其实就一行）。

11/30：几乎是花了一个下午和傍晚解决讯飞的接口问题。由于对前端的调用不了解，以为和python一样很方便，所以在出错后有点盲目，不知道怎么改。甚至尝试了用python调用api后再生成一个后端接口再让react调用，也没有成功。后来咨询了yuuki学长（狗头），查阅了相关实现经验帖，借助GPT后基本解决（之前一直没有生成鉴权URL，觉得麻烦，以为只用apikey就可以直接调用，比较孤陋寡闻）事实证明不能怕麻烦捏~最好的捷径就是不走捷径

12/1：微调了一下UI，改成杭助蓝（从主页拿来的），形成最终版。

12/2：写技术文档，提交至仓库。溜去数模了